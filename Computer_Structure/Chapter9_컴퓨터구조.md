# Chapter9_기억장치 memory

9.1 기억장치 특성
---
### 9.1.1 기억장치 종류
주기억장치- cpu에 바로 연결 
* 중앙처리장치와 on-line 연결
* 중앙처리장치가 필요할 때 즉시 사용할 수 있다.
* ROM (Read Only Memory): 비휘발성, 부트로더
* RAM (Random Access Memory): 휘발성


보조기억장치 - cpu와 별도 연결
* 중앙처리장치와 off-line 연결
* 중앙처리장치가 데이터를 사용하려면 별도로 연결 과정을 거쳐야 한다.
* 데이터를 반영구적으로 보관하는 일종의 입출력장치
* 플로피 디스크, 하드 디스크, CD-ROM, USB 기억장치, SSD

### 9.1.2 물리적 특성
휘발성(volatile)
* 기억장치의 전원을 제거하면, 저장된 내용이 없어진다.
* RAM
비휘발성(nonvolatile)
* 기억장치의 전원을 제거하더라도, 내용이 그대로 유지한다.
* ROM, 보조기억장치
삭제 가능(erasable)
* 한 번 기록된 내용을 지우고 다른 값으로 갱신할 수 있다.
* RAM, 하드 디스크
삭제 불가능(non-erasable)
* 한 번 기록된 내용을 지우거나 갱신할 수 없다.
* ROM, CD-ROM

### 9.1.3 용량 및 전송 단위
기억장치 용량  
* 기억장치가 저장할 수 있는 데이터의 전체 크기
* 일반적으로 바이트 단위
주기억장치  
* 바이트 단위 구성
* 정렬된 단어 단위 액세스
* 8, 16, 32, 64 비트 단어
보조기억장치 - 큰 용량을 저장을 목적으로함. 속도가 느린편.
* 바이트 단위 구성
* 블록 단위 액세스
* 블록 크기: 512 bytes, 1Kbytes, 2Kbytes, 또는 4Kbytes



### 9.1.4 액세스 방법

| 구분                       | 액세스 방법 | 예 | 액세스 시간 |
|----------------------------|-------------|----|-------------|
|순차 액세스(sequential access) |   처음부터 차례대로  | 자기 테이프   | 파일위치로 이동하는시간 추가 |  
|직접 액세스(direct access) |   헤드를 임의의 위치로 이동하여 액세스  | 자기 디스크, CD-ROM | 디스크 헤드 이동 시간 |  
|임의 액세스 (random access)|   임의의 위치 액세스 + 액세스 시간 동일  | 반도체 주기억장치, ROM, RAM| 주소 제공 후 액세스하므로 항상 같음 |  
|연관 액세스 (associative access) |  테이블 구조에 대한 내용(키)에 의한 액세스  | 연관 기억장치, CAM | 데이터 위치와 무관하게 항상 같음 |  

연관 기억장치(associative memory)  
* CAM(Content Addressable Memory)
* 고속 탐색을 위한 특수 기억장치

### 9.1.5 성능 척도

* 액세스 시간(access time) : 기억장치에 주소와 제어신호를 제공한 후 데이터가 읽혀지거나 쓰여지기 시작할 때까지 시간
* 사이클 시간(cycle time) : 기억장치를 연속적으로 액세스할 때 소요되는 시간 액세스 시간 + 여유 시간
* 전송률(transfer rate) : 1초에 액세스할 수 있는 데이터의 양. 1/(사이클 시간) 단위는 bps (bits per second)
* 대역 폭(bandwidth) : 데이터 통신에서 채널이 수용할 수 있는 주파수 대역의 범위 기억장치에서는 전송률과 같은 의미로 사용함

### 9.1.6 기억장치 계층
기억장치 계층
* 액세스 속도는 빠르고, 용량은 많게.
* 당장 처리할 데이터를 속도가 빠른 장치로 옮겨놓고 사용

디스크 캐시 - 보조기억장치가 cpu로 갈때, 그 차이를 디스크 캐시가 줄여준다.

9.2 반도체 기억장치
---
### 9.2.1 종류와 특성
### 9.2.2 반도체 기억장치 구조

SRAM, DRAM, EEPROM, NOR 플래시 , NAND 플래시

 
9.3 기억장치 모듈 설계
---
### 9.3.1 기억장치 비트 폭 확장
### 9.3.2 기억장치 용량 확장


9.4 캐시기억장치
---
### 9.4.1 참조의 지역성
참조의 지역성 (locality of reference)
* 프로세서가 프로그램을 수행할 때 기억장치의 특정 부분을 집중적으로
참조하는 경향이 있다.
공간적 참조의 지역성
* 기억장치에 가깝게 배치되어 있는 명령어 또는 데이터를 다음 번에도 계
속 참조할 가능성이 크다.
* 명령어> 거리가 짧은 루프 반복 실행. 
* 데이터> 데이터는 기억장치에 같은 영역에 가깝게 배치되어 있음.
시간적 참조의 지역성
* 한 번 사용한 명령어와 데이터를 짧은 시간 안에 다시 참조할 가능성이
크다.
* 명령어> 함수 호출 후 복귀
* 데이터> 함수 안 프로그램은 같은 지역 변수를 여러 번 사용함.

**데이터전송단위**
적중(hit)  
* 중앙처리장치가 원하는 단어가 캐시 기억장치에 들어 있음.
* 캐시에서 단어 액세스
실패(miss)  
* 중앙처리장치가 원하는 단어가 캐시 기억장치에 없음.
* 주기억장치에서 단어를 포함하고 있는 블록을 캐시로 전송 후, 캐시에서
단어 액세스

### 9.4.2 캐시 기억장치 구조
전송 단위  
* 주기억장치 전송 단위: 블록 캐시
* 기억장치 전송 단위: 라인 (슬롯)
* 일반적으로 블록 크기 = 라인 크기

주기억장치 주소 = {태그 필드, 라인 필드, 단어 필드 }  
* 단어 필드: 캐시 라인 안에서 단어 지정. 길이 = log2W (W: 라인 내 단어 수)
* 라인 필드: 캐시의 라인 번호 지정. (길이는 매핑 방법에 따라 다르다.)
* 태그 필드: 캐시 라인에 어느 주기억장치 블록이 들어 있는지 나타낸다.
캐시의 태그 영역에 저장된다.

**데이터 액세스**
데이터읽기, 데이터쓰기, 캐시동작. 

캐시 동작  
* 캐시 도입 목적이 액세스 속도 개선이므로 캐시 동작은 모두 하드웨어로
처리된다. 프로그래머는 캐시가 있음을 모른다.
* 빠르게 검색할 수 있도록 캐시는 연관기억장치로 만들어져 있다.

### 9.4.3 캐시 설계시 고려 사항
계층적 구성
* On-chip 레벨 1 캐시: 명령어 캐시, 데이터 캐시
* Off-chip 레벨 2 캐시

### 9.4.4 매핑 함수
매핑 함수 (mapping function)  
* 주기억장치 한 개의 블록을 캐시 라인에 할당하는 규칙
종류  
* 직접매핑 (direct mapping)
* 완전연관매핑 (full associative mapping)
* 집합연관매핑 (set-associative mapping)

### 9.4.5 교체 정책
교체 정책  
* 캐시 실패시, 캐시 라인 중 하나를 선택하는 방법
* 직접 매핑: 교체 정책 불필요
* 완전 연관 매핑, 집합 연관 매핑: 교체 정책 필요
이상적인 교체 정책  
* 향후 가장 오랫동안 사용하지 않을 라인 선택
* 구현 불가

| 알고리즘           | 교체 라인 선택 방법  |  특징 |  USE 카운터 |선택 |
|------------------|---------------------|-------|-----------|-----|
|LRU_Least Recently Used | 가장 오래 전에 사용한 라인 선택 | 성능 우수 |  라인을 사용할 때 0 다른 라인은 증가 가장 큰 라인 선택 | 큰 값   |
|FIFO_First-In-First-Out | 가장 먼저 캐시에 들어온 라인 선택 | 자주 사용될 가능성 존재 |  캐시 라인이 들어올 때 0다른 라인은 증가 | 큰 값   |
|LFU Least Frequently Used | 가장 적게 사용한 라인 선택| 자주 사용될 가능성 존재 |  캐시 라인이 들어올 때 0다른 라인은 증가 | 작은 값 |
|Random | 임의로 라인 선택| 비교적 성능 우수 |  - | - |


###  9.4.6 쓰기 정책
Write-through : 캐시 라인과 주기억장치 블록을 함께 수정, 교체할 때, 블록을 캐시로 복사 // 캐시 일관성 유지,주기억장치 액세스 증가
Write-back : 캐시 라인만 수정하고 dirty 비트 세트, Dirty 라인을 교체할 때, 주기억장치에 저장 후 복사 // 빠름, 불일치 순간 존재

### 9.4.7 일관성 유지
**일관성 유지 방법**
방법  
* 캐시 불가능 영역(non-cacheable region) 지정
* 버스 감시bus watching)
* 동시 갱신(concurrent update)
MESI 알고리즘: 캐시 라인 상태 관리  
* 수정 (modified)
* 배타 (exclusive)
* 공유 (shared)
* 무효 (invalid)
