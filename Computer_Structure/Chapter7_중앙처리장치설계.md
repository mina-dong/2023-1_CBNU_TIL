# Chapter7_중앙처리장치 설계

### 6.1.2 명령어 종류

7.1 프로그래머 모델
---
**상태 레지스터**
플래그 종류  
* Zero flag
* Sign flag
* Carry flag
* oVerflow flag
* IR (Interrupt Request flag)
* IE (Interrupt Enable flag)
표현  
* (상태 레지스터).(플래그 이름)
* 예) SR.C, SR.IR

7.2 명령어 형식
---
명령어 형식
* 기억장치 단어의 2배(16비트)인 고정 길이 명령어
* 데이터 처리 명령어는 레지스터만으로 동작
* 적재(load)와 저장(store)만으로 기억장치 액세스
* 기억장치를 액세스할 때는 레지스터 간접 주소지정방식 사용
* 프로그램 제어 명령어는 상대 주소지정방식으로 분기 목적지 표현
명령어 형식의 필드
* 동작코드(opcode): 명령어 또는 명령어 그룹을 구분하는 코드
* 즉치(immediate): 즉치 주소지정방식에서 명령어에 포함되는 상수
* 부동작코드(sop1, sop2): 같은 그룹의 명령어를 세분화하는 코드
* 목적지 레지스터(Rd): 명령어의 목적지 레지스터 번호
* 소스 레지스터(Rs1, Rs2): 명령어의 소스 레지스터 번호
* 변위(offset): 상대 주소지정방식의 변위

**주소지정방식**                                                  
즉치 주소지정방식
* 즉치 데이터 적재 명령어(LDI)가 사용한다.
레지스터 간접 주소지정방식
* 기억장치에 유효 데이터가 있는 적재와 저장 명령어가 사용한다. 
* 레지스터 쌍에 기억장치 주소를 저장한다.
레지스터 주소지정방식
* 레지스터 간 데이터 이동, 단항과 이항 연산 명령어, 비교 명령어가 사용
한다.
상대 주소지정방식
* 무조건분기, 조건분기, 서브루틴 호출 명령어가 사용한다.
* 프로그램 카운터 값과 분기 목적지 주소 간의 거리를 변위(offset) 필드로
표현한다.
* 변위의 범위는 1KB
  
7.3 명령어 집합
---

데이터 전달 명령어, 데이터 처리 명령어, 비교 및 프래그 설정 명령어, 분기 명령어, 서브루틴 호출 및 인터럽트 명령어, 시스템 관리 명령어로 이루어져있음.

단, toycom 명령어이기도 하고, 상세한 설명은 해당페이지에서 하지 않음.

명령어마다 비트패턴이 어덯게 되어있는지, 동작에 관해서만 이해함.

7.4 명령어 사이클
---
인출단계 2 바이트 명령어를 IR에 저장한다.
실행단계 명령어를 실행하고, SR.IR에 따라 다음 단계 결정한다.
정지단계 HALT 명령어를 실행하면 시스템을 정지한다.
인터럽트단계 SR.IR=1일 때, 인터럽트 단계로 이동한다

**인터럽트 벡터**
인터럽트 종류
* 0 번: 시스템 리셋
* 1 번: HALT 명령어
* 2 번: 외부 인터럽트
인터럽트 벡터
* ISR 시작 주소의 모임
인터럽트 발생시
* PC <- 2ⅹ인터럽트 번호

7.5 마이크로오퍼레이션
---
### 7.5.1 인출 단계
동작   
IR <-Mem[PC]    
PC<-Pc+2    

마이크로오퍼레이션  
MAR <- PC    
MBR <-Mem(MAR), PC<-PC+1   
IRL<-MBR  
MAR<-PC  
MBR<-Mem(MAR), PC<-PC+1  
IRH<-MBR  

### 7.5.2 실행 단계
명령어 별로 마이크로오퍼레이션 정의
* 데이터 전달 명령어
* 데이터 처리 명령어
* 비교 및 플래그 설정 명령어
* 분기 명령어
* 서브루틴 호출 및 인터럽트 명령어
* 시스템 관리 명령어
프로그래머 모델 고려


### 7.5.3 정지 단계
HALT 명령어를 실행할 때
인터럽트 1번 ISR
* Invalid opcode
정지 단계 이후 다음 단계가 없다.

### 7.5.4 인터럽트 단계


7.6 제어신호
---
### 7.6.1 마이크로오퍼레이션 선택
마이크로오퍼레이션 선택
* 7.5절에서 구한 마이크로오퍼레이션은 중복되어 있다.
* 중복되지 않도록 마이크로오퍼레이션을 선택한다.

### 7.6.2 제어신호 할당
제어신호 표현 규칙
* 접두어 [I/O]
* I: 내부 버스에서 레지스터로 데이터를 적재
* O: 레지스터의 값을 내부 버스로 출력
* 레지스터 이름
* 제어신호를 할당할 레지스터 이름
* 접미어 [H/L/A]
* 사용하는 내부 버스를 특별히 표시할 필요가 있을 때 접미어를 붙인다.
* H: HBus L: LBus A: 둘 다.
예
* IIRL: LBus에서 IR 레지스터로 데이터로 적재하는 제어신호
* OMBRL: MBR 레지스터의 값을 LBus로 출력하는 제어신호

**추가제어신호**
PC
* (IncPC) PC <- PC+1: 명령어를 인출할 때, PC 값을 증가시킨다.
* (LdVec) PC <- 2ⅹn: 인터럽트 요청이 있을 때 PC에 인터럽트 서비스 루틴
의 시작 주소를 적재한다. 
* (AddPC) PC <- PC+IRH[10:8]:IRL: 조건분기 명령어에서 PC 값에 변위를 더
한다. 변위는 IR[10:0]에 저장되어 있다. 
SP
* (DesSP) SP ← SP–1: 스택에 푸시할 때 SP의 값을 감소시킨다.
* (IncSP) SP ← SP+1: 스택에서 팝할 때 SP의 값을 증가시킨다.
연산기
* 연산기가 동작하지 않음: NOP
* 단항 마이크로오퍼레이션: INC, DEC, NEG, NOT, SHL, SHR, ASL, ASR
* 이항 마이크로오퍼레이션: ADD, ADC, SUB, SBC, AND, OR, XOR

### 7.6.3 검증
검증 과정
* 예제 프로그램에 대하여
* 명령어 실행 사이클(인출단계, 실행단계)에 따라
* 제어신호가 적절히 생성되어
* 명령어가 올바로 실행되는지 검사한다.

